name: ğŸ•µï¸ Verify Vault Sync (Global Dump)

on:
  push:
    branches: [ "main", "feature/*" ]
  workflow_dispatch:

jobs:
  audit-configuration:
    name: ğŸ›¡ï¸ Audit Global Context
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout Code
        uses: actions/checkout@v4

      # ------------------------------------------------------------------------
      # Ã‰TAPE 1 : DUMP DES VARIABLES (Contexte 'vars')
      # ------------------------------------------------------------------------
      - name: ğŸ“‚ Dump All Variables
        run: |
          echo "::group::ğŸ“„ Variables Context (JSON)"
          echo "Voici toutes les variables non-sensibles disponibles :"
          echo '${{ toJSON(vars) }}'
          echo "::endgroup::"

      # ------------------------------------------------------------------------
      # Ã‰TAPE 2 : DUMP DES SECRETS (Contexte 'secrets')
      # ------------------------------------------------------------------------
      - name: ğŸ” Dump All Secrets keys
        run: |
          echo "::group::ğŸ—ï¸ Secrets Context (JSON)"
          echo "Voici tous les secrets disponibles (Valeurs masquÃ©es par sÃ©curitÃ©) :"
          echo "âš ï¸ Note : Si vous voyez les clÃ©s VAULT_*, c'est que la synchro fonctionne."
          
          # GitHub va afficher les clÃ©s, mais remplacera les valeurs par ***
          echo '${{ toJSON(secrets) }}'
          
          echo "::endgroup::"

      # ------------------------------------------------------------------------
      # Ã‰TAPE 3 : DUMP DE L'ENVIRONNEMENT (Variables d'env du Runner)
      # ------------------------------------------------------------------------
      - name: ğŸŒ Dump Environment
        run: |
          echo "::group::ğŸ§ Environment Variables"
          # Affiche tout ce que le systÃ¨me connait (sauf les secrets non mappÃ©s)
          env | sort
          echo "::endgroup::"